<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Groupomania</title>

    <meta charset="utf-8" />
    <meta name="description" content="Réseau social d'entreprise" />
    <!-- <link rel="icon" href="<%= BASE_URL %>favicon.ico" /> -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link href="../css/style.css" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <div id="app">
      <header>
        <div class="limitedWidthBlockContainer informations">
          <div class="limitedWidthBlock">
            <ul>
              <li>
                <img
                  src="../images/icons/phone.svg"
                  alt="logo de téléphone"
                  class="informations__phone"
                />{{tel}}
              </li>
            </ul>
          </div>
        </div>
        <div class="limitedWidthBlockContainer menu">
          <div class="limitedWidthBlock">
            <a href="./index.html">
              <img
                class="logo"
                src="../images/logo.png"
                alt="Logo de l'entreprise"
              />
            </a>
            <nav>
              <ul>
                <li><a href="./signup.html">signup</a></li>
                <li><a href="./login.html">login</a></li>
              </ul>
            </nav>
          </div>
        </div>
        <img class="banniere" src="../images/banniere.png" alt="Baniere" />
      </header>

      <main class="limitedWidthBlockContainer">
        <div class="limitedWidthBlock">
          <div class="titles">
            <h1>{{message}}</h1>
            <h2>Voici un espace d'échange entre les salariés</h2>
            <h2>Pour tout ce que vous voulez partager sur l'entreprise</h2>
            <h2>Tout est permis, mais avec modération.</h2>
          </div>
        </div>
      </main>

      <footer>
        <div class="limitedWidthBlockContainer footerMain">
          <div class="limitedWidthBlock">
            <div>
              <img
                class="logo"
                src="../images/logo.png"
                alt="Logo de l'entreprise"
              />
            </div>
            <div>
              <p>{{adresse}} <br />{{ville}}</p>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <script src="https://unpkg.com/vue@next"></script>

    <script>
      //----------------------------------------------------------------------------
      // vuejs3
      //----------------------------------------------------------------------------

      const RootComponent = {
        //les data
        data() {
          return {
            // infos de l'entreprise
            adresse: "rue de l'horizon",
            ville: "19300 labas sur Correze",
            tel: "01 23 45 67 89",

            // infos de login et signup
            loginForm: false, // Formulaire de login
            signupForm: false, //formulaire de signup
            email: "",
            passwd: "",
            pseudo: "",
          };
        }, // fin des data

        //----------------------------------------------------------------------------
        //Initialisation de la page
        //-----------------------------------------------------------------------------
        beforeCreate() {},

        //----------------------------------------------------------------------------
        // Suite initialisation
        // Affichage de la page au chargement

        //----------------------------------------------------------------------------
        created() {}, // Fin created

        //------------------------------------------------------------------------------------
        // Page complètement chargée
        //------------------------------------------------------------------------------------
        mounted() {},

        //------------------------------------------------------------------------------------
        // Les methodes
        //------------------------------------------------------------------------------------
        methods: {
          //-----------------------------------------------------------------------------------------
          // login
          // affichage du formulaire de  login
          //
          // param: aucun
          //-------------------------------------------------

          login() {
            console.log("login");
            this.loginForm = true; // ouverture formulaire
            this.email = "";
            this.passwd = "";
          },
          //-----------------------------------------------------------------------------------------
          // validateLogin
          // login d'un utilisateur quand il a cliqué sur validate
          // param:
          //    methode: POST
          //    URL: URL=http://localhost:3000/api/auth/
          //    date: email, passwd
          //---------------------------------------------------------------------------------

          validateLogin() {
            console.log("login ");

            // les data du body du fetch
            const data = (data = { email: this.email, password: this.passwd });

            //Url  du user
            const userUrl = "http://localhost:3000/api/auth/";

            //header
            const bearerToken = "bearer null";

            fetch(userUrl, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: bearerToken,
              },
              body: JSON.stringify(data),
            })
              .then((response) => response.json()) //reponse du fetch
              .catch((error) => {
                console.log("Fetch error: ", error);
              })
              .then((response) => {
                window.alert(response.message); // affiche msg de retour du serveur
                this.loginForm = false; // on replie le formulaire et on reinit les variables.
                this.email = "";
                this.passwd = "";
                this.pseudo = "";
              })
              .catch((error) => {
                console.log("Response error: ", error);
              });
          }, //Fin Validate login

          //------------------------------------------------------------------------------
          //Cancel login
          // si l'utilisateur a cliqué sur le bouton cancel.
          //---------------------------------------------------------------------------------
          cancelLogin() {
            this.loginForm = false; // on replie le formulaire et on reinit les variables.
            this.email = "";
            this.passwd = "";
            this.pseudo = "";
          },
        }, // Fin des methodes
      }; // Fin RootComponent

      const app = Vue.createApp(RootComponent).mount("#app");
      console.log(app);
    </script>
  </body>
</html>
