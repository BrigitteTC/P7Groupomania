<!DOCTYPE html>
<html lang="fr">
  <head>
    <title>Groupomania</title>

    <meta charset="utf-8" />

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <meta name="description" content="Réseau social d'entreprise" />
    <link rel="icon" href="<%= BASE_URL %>favicon.ico" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link href="../css/style.css" rel="stylesheet" />
    <link href="../css/posts.css" rel="stylesheet" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>

  <body>
    <header>
      <div class="limitedWidthBlockContainer informations">
        <div class="limitedWidthBlock">
          <ul>
            <li>
              <img
                src="../images/icons/phone.svg"
                alt="logo de téléphone"
                class="informations__phone"
              />012345678
            </li>
          </ul>
        </div>
      </div>
      <div class="limitedWidthBlockContainer menu">
        <div class="limitedWidthBlock">
          <a href="./index.html">
            <img
              class="logo"
              src="../images/logo.png"
              alt="Logo de l'entreprise"
            />
          </a>
          <nav>
            <ul>
              <a href="./index.html"><li>accueil</li></a>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <main class="limitedWidthBlockContainer">
      <div class="limitedWidthBlock" id="limitedWidthBlock">
        <div class="cartAndFormContainer" id="cartAndFormContainer">
          <h1>Les publications de l'entreprise</h1>
          <section class="cart">
            <section id="cart__items">
              <!--   debut affichage des posts-->
              <div id="app-vue">
                <h2>Les posts</h2>
                <div class="users">
                  <div v-if="errored">
                    <p>Serveur indisponible</p>
                  </div>

                  <div v-else>
                    <h4 v-if="loading">Loading... dernières nouvelles</h4>
                    <div v-for="item in posts" :key="post" class="post">
                      <article>
                        <div class="cart__item__content">
                          post: {{item.post}} par userId : {{item.userId}}
                        </div>
                      </article>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </div>
    </main>

    <footer>
      <div class="limitedWidthBlockContainer footerMain">
        <div class="limitedWidthBlock">
          <div>
            <img
              class="logo"
              src="../images/logo.png"
              alt="Logo de l'entreprise"
            />
          </div>
          <div>
            <!--<p>{{adresse}} <br />{{ville}}</p>-->
          </div>
        </div>
      </div>
    </footer>

    <script>
      new Vue({
        el: "#app-vue",

        data() {
          return {
            posts: null,
            loading: false,
            errored: false,
          };
        },
        created() {
          // Creating loader
          this.loading = true;
          this.posts = null;

          // Lecture du local storage pour récupérer les infos du user
          let userInLocalStorage = JSON.parse(localStorage.getItem("user")); //objet "user" du local storage
          const userToken = userInLocalStorage.token; // le token

          const bearerToken = "Bearer " + userToken;
          console.log(" bearerToken  :  " + bearerToken);

          //appel axios pour GET posts
          console.log("appel GET axios");
          axios
            .get(`http://localhost:3000/api/post/`, {
              headers: {
                Authorization: bearerToken,
              },
            })
            .then((response) => {
              console.log("reponse du back", response);
              // JSON response

              console.log("reponse du back data", response.data);
              this.posts = response.data.posts;
            })

            // Dealing with errors
            .catch((error) => {
              console.log("error", error);
              this.errored = true;
            });
        },
      });
    </script>
  </body>
</html>
